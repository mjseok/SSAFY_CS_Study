# 트랜잭션

## 트랜잭션이란?
DB의 상태를 변화 시키기 위해 수행시키는 작업단위.
DB의 상태를 변화 시키기 위해 SELECT, INSERT, DELETE, UPDATE가 사용된다. 이 작업단위는 질의어 한 문장이 아닌 사람이 정하는 기준에 따라 정해진다.
<B>이 작업단위는 더 이상 쪼갤 수 없다.<B>

## 트랜잭션의 특징
- 원자성 (Atomicity)
    - 트랜잭션 내의 모든 명령이 완벽하게 수행되지 못하면 모든 트랜잭션을 취소하여, 트랜잭션이 모두 성공하거나 모두 실패한 둘 중 하나의 상태가 되게 하는것 (All or Nothing)
    - 원자성이 확보되지 않으면 트랜잭션이 끊길 경우 어디서 부터 이어서 수행해야할지 알 수 없기 때문이다.

- 일관성 (Consistency)
    - 트랜잭션이 완료된 결과같이 일관적인 DB 상태를 유지하는것
    - 데이터 베이스의 제약조건을 위배하지 않는 성질을 의미한다.

- 고립성 (Isolation)
    - 트랜잭션이 실행되는 동안 다른 트랜잭션의 작업이 끼어들지 못하도록 작업하는것. 즉, 트랜잭션끼리는 서로 간섭할 수 없다,
    - 트랜잭션이 데이터를 사용중인 경우 해당 데이터에 대해 다른 트랜잭션이 접근할 수 없다.
    - 공유 락을 통해 데이터를 읽을때만 사용가능 하고 데이터를 쓰는 배타 락을 사용할땐 접근 할 수 없다.

- 지속성 (Durability)
    - 트랜잭션이 정상적으로 종료된 잉후에 DB에 작업 결과가 영구적으로 저장 되어야한다.

## 트랜잭션의 연산
- 커밋 (Commit)
    - 커밋 연산은 모든 작업을 정상적으로 처리했다고 확정하는 명령어로 처리 과정을 데이터 베이스에 영구적으로 저장한다.
    - 커밋은 하나의 트랜잭션이 종료되었음을 의미한다.

- 롤백 (Rollback)
    - 롤백 연산은 작업중 문제가 발생하여 트랜잭션의 처리과정에서 발생한 모든 변경사항을 취소하는 명령어이다/
    - 일반적으로 롤백 명령시 작업전체가 취소되어 (원자성) 이전 커밋으로 돌아간다.

- 세이브 포인트(SavePoint)
    - 세이브 포인트는 임시저장과 같은 맥락으로 롤백 명령시 작업 전체가 취소되는것이 아닌 특정 부분에서 트랜잭션을 취소하기 위해 사용된다.
    - 여러 SQL문을 수행하는 트랜잭션의 경우 사용자가 중간 단계에서 세이브 포인트를 지정해 롤백 연산이 실행되면 이전 커밋이 아닌 이전 세이브 포인트로 작업이 롤백된다.

## 트랜잭션의 상태
트랜 잭션에는 5가지 상태가 존재한다.
- 활동 (Active)
    - 트랜잭션이 실행중인 상태
- 실패 (Failed)
    - 트랜잭션 실행에 오류가 발생하여 중단된 상태
- 철회 (Aborted)
    - 트랜잭션 실행에 오류가 발생하여 Rollback연산을 수행한 상태
- 부분 완료 (Partically commited)
    - 트랜잭션의 마지막 연산까지 실행하고 커밋 연산을 실행하기 직전의 상태
- 완료 (commited)
    - 트랜잭션이 성공적을 종료되어 커밋 연산을 실행한 후의 상태

![Transaction State](http://wiki.hash.kr/images/thumb/a/a5/%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98%EC%9D%98_%EC%83%81%ED%83%9C.png/800px-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98%EC%9D%98_%EC%83%81%ED%83%9C.png)

## 트랜잭션의 락
트랜잭션 처리의 순차성을 보장하기 위한 방법이다.<br>
트랜잭션의 특징중 격리성을 락킹 기법을 통해 확보한다.

- 공유 락
    - 공유 락은 읽기 전용이며 특정 데이터에 공유락을 걸면 다른 트랜잭션이 해당 데이터에 배타 락을 걸 수 없다.

- 배타 락
    - 배타 락은 자료를 갱신할 때 트랜잭션이 데이터에 사용한다.
    해당 데이터는 다른 트랜잭션에서 접근할 수 없다.

### 데드 락
두개 이상의 트랜잭션이 각각 데이터를 배타록을 걸고 상대의 데이터를 필요로 하면 영원히 자원을 기다리는 교착상태인 데드락에 빠지게 된다.

데드락은 회피기법을 통해 회피하거나 트랜잭션에 타임아웃을 걸어 자연스레 데드락을 해제하도록 하는 타임아웃 기법들을 통해 해결할 수 있다.
