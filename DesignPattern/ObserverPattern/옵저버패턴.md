# Observer pattern

- ì˜µì €ë²„ íŒ¨í„´ì€ ë””ìì¸ íŒ¨í„´ ì¤‘ í•˜ë‚˜
- ì£¼ì²´ê°€ ì–´ë–¤ ê°ì²´ì˜ ìƒíƒœ ë³€í™”ë¥¼ ê´€ì°°í•˜ë‹¤ê°€ ìƒíƒœ ë³€í™”ê°€ ìˆì„ ë•Œë§ˆë‹¤ ë©”ì„œë“œ ë“±ì„ í†µí•´ ì˜µì €ë²„ ëª©ë¡ì— ìˆëŠ” ì˜µì €ë²„ë“¤ì—ê²Œ ë³€í™”ë¥¼ ì•Œë ¤ì¤€ë‹¤.
- ì´ ì£¼ì²´ì™€ ì˜µì €ë²„ ì‚¬ì´ì˜ ì—°ê²°ì€ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì´ìš©í•´ì„œ ëŠìŠ¨í•œ ê²°í•©ì„ ìœ ì§€í•˜ë©°, ì£¼ì²´, ì˜µì €ë²„ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‚¬ìš©í•œë‹¤.

```
â“ ì£¼ì²´ : ê°ì²´ì˜ ìƒíƒœ ë³€í™”ë¥¼ ë³´ê³  ìˆëŠ” ê´€ì°°ì
â“ ì˜µì €ë²„ : ì´ ê°ì²´ì˜ ìƒíƒœ ë³€í™”ì— ë”°ë¼ ì „ë‹¬ë˜ëŠ” ë©”ì„œë“œ ë“±ì„ ê¸°ë°˜ìœ¼ë¡œ 'ì¶”ê°€ ë³€í™” ì‚¬í•­'ì´ ìƒê¸°ëŠ” ê°ì²´ë“¤ì„ ì˜ë¯¸.
```

ê°ì²´ì™€ ì£¼ì²´ê°€ ë¶„ë¦¬ë˜ì–´ ìˆì„ ìˆ˜ë„ ìˆê³ , í•©ì³ì ¸ ìˆì„ ìˆ˜ë„ ìˆê³  ì£¼ì²´ì™€ ê°ì²´ë¥¼ êµ¬ë¶„ì§“ì§€ ì•Šì„ ìˆ˜ë„ ìˆë‹¤.

### [ê°ì²´ ì£¼ì²´ ë¶„ë¦¬, í•©ì²´]

![image](https://user-images.githubusercontent.com/57527380/189568546-5d0a9f30-1558-4d2c-85df-d7995a56897d.png)

### [ì£¼ì²´,ê°ì²´ êµ¬ë¶„ x]

ì˜ˆì‹œ : íŠ¸ìœ„í„°  
ì£¼ì²´ë¥¼ íŒ”ë¡œìš° í•œ ì‚¬ëŒë“¤ì´ ì˜µì €ë²„, ì£¼ì²´ê°€ ìƒˆë¡œìš´ íŠ¸ìœ—ì„ ì˜¬ë¦¬ë©´ ì˜µì €ë²„ë“¤ì—ê²Œ ì•Œë ¤ì¤Œ.

## ì˜µì €ë²„ íŒ¨í„´ êµ¬ì¡°

- ì´ë²¤íŠ¸ ê¸°ë°˜ ì‹œìŠ¤í…œì— ì‚¬ìš©
- MVCíŒ¨í„´ì—ë„ ì‚¬ìš©ëœë‹¤.

![image](https://user-images.githubusercontent.com/57527380/189569628-3de8601a-6f24-4914-ae22-9a59be21b00b.png)
ëª¨ë¸ì—ì„œ ë³€ê²½ì‚¬í•­ì´ ìƒê¸°ë©´ viewì— update()ë©”ì„œë“œë¥¼ í†µí•´ ì•Œë ¤ì£¼ê³ , controllerëŠ” ì´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë™ì‘í•œë‹¤.

## ì˜ˆì‹œ

[ì½”ë“œ ì¶œì²˜](https://github.com/gilbutITbook/080326)

### Java

<details>
<summary>JAVAì½”ë“œ</summary>

```java
/*
ì½”ë“œ ì¶œì²˜ : https://github.com/gilbutITbook/080326
*/
import java.util.ArrayList;
import java.util.List;

interface Subject { //ê°ì²´
    public void register(Observer obj);
    public void unregister(Observer obj);
    public void notifyObservers();
    public Object getUpdate(Observer obj);
}

interface Observer { //ì˜µì €ë²„
    public void update();
}

class Topic implements Subject { //ì£¼ì²´ì´ì ê°ì²´
    private List<Observer> observers;
    private String message;

    public Topic() {
        this.observers = new ArrayList<>();
        this.message = "";
    }

    @Override
    //ì˜µì €ë²„ë¡œ ë“±ë¡
    public void register(Observer obj) {
        if (!observers.contains(obj)) observers.add(obj);
    }

    @Override
    //ì˜µì €ë²„ ëª©ë¡ì—ì„œ ì œê±°
    public void unregister(Observer obj) {
        observers.remove(obj);
    }

    @Override
    //ì˜µì €ë²„ì—ê²Œ updateí–ˆë‹¤ê³  ì•Œë¦¬ê¸°
    public void notifyObservers() {
        this.observers.forEach(Observer::update);
    }

    @Override
    //updateë‚´ìš© ê°€ì ¸ì˜¤ê¸°
    public Object getUpdate(Observer obj) {
        return this.message;
    }
    // ë©”ì‹œì§€ update(ë³€í™”ë¥¼ ê´€ì°°í•˜ê³  ìˆëŠ” ë¶€ë¶„)í•˜ê³  ì˜µì €ë²„ì—ê²Œ ì•Œë¦¬ê¸°
    public void postMessage(String msg) {
        System.out.println("Message sended to Topic: " + msg);
        this.message = msg;
        notifyObservers();
    }
}
//ì˜µì €ë²„(topic êµ¬ë…)
class TopicSubscriber implements Observer {
    private String name;
    private Subject topic;

    public TopicSubscriber(String name, Subject topic) {
        this.name = name;
        this.topic = topic;
    }

    @Override
    //ì˜µì €ë²„ update()ë©”ì„œë“œ -> ì£¼ì²´,ê°ì²´ì˜ notifyObservers()ë¥¼ í†µí•´ ì‘ë™ë¨
    public void update() {
        //updateëœ msgë°›ì•„ì„œ ì¶œë ¥
        String msg = (String) topic.getUpdate(this);
        System.out.println(name + ":: got message >> " + msg);
    }
}

public class HelloWorld {
    public static void main(String[] args) {
        Topic topic = new Topic();
        Observer a = new TopicSubscriber("a", topic); //ì˜µì €ë²„ ì„ ì–¸
        Observer b = new TopicSubscriber("b", topic);
        Observer c = new TopicSubscriber("c", topic);
        topic.register(a);//topicì˜ ì˜µì €ë²„ë¡œ ë“±ë¡
        topic.register(b);
        topic.register(c);

        topic.postMessage("amumu is op champion!!"); //ë©”ì‹œì§€ê°€ ë³€í™”í•¨
    }
}
/*
Message sended to Topic: amumu is op champion!!
a:: got message >> amumu is op champion!!
b:: got message >> amumu is op champion!!
c:: got message >> amumu is op champion!!
*/
```

</details>

Javaì—ëŠ” ì˜µì €ë²„ íŒ¨í„´ì„ ì ìš©í•  ìˆ˜ ìˆëŠ” `Observer`ì¸í„°í˜ì´ìŠ¤ì™€ `Observable`í´ë˜ìŠ¤ë¥¼ ê¸°ë³¸ì ìœ¼ë¡œ ì œê³µí•´ì¤€ë‹¤.  
Observableì€ í´ë˜ìŠ¤ë¡œ êµ¬í˜„ë˜ì–´ ìˆê¸° ë•Œë¬¸ì— ìƒì†ì„ í•´ì•¼í•˜ê³ , ìë°”ëŠ” ë‹¤ì¤‘ ìƒì†ì´ ì•ˆë˜ê¸° ë•Œë¬¸ì— ì´ë¡œ ì¸í•œ í•œê³„ê°€ ìˆë‹¤.

### JavaScript

í”„ë¡ì‹œ ê°ì²´ë¥¼ í†µí•´ êµ¬í˜„

```
â“ í”„ë¡ì‹œ ê°ì²´ : ì–´ë–¤ ëŒ€ìƒì˜ ê¸°ë³¸ì ì¸ ë™ì‘ì˜ ì‘ì—…ì„ ê°€ë¡œì±Œ ìˆ˜ ìˆëŠ” ê°ì²´
ìë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œ í”„ë¡ì‹œ ê°ì²´ëŠ” target,handler ë‘ê°œì˜ ë§¤ê°œë³€ìˆ˜ë¥¼ ê°€ì§‘ë‹ˆë‹¤.
target : í”„ë¡ì‹œí•  ëŒ€ìƒ
handler : í”„ë¡ì‹œ ê°ì²´ì˜ targetë™ì‘ì„ ê°€ë¡œì±„ì„œ ì‹¤í–‰ë  í•¨ìˆ˜
```

<details>
<summary>JavaScriptì½”ë“œ</summary>

```js
/*
target : ëŒ€ìƒ ê°ì²´
property: ì„¤ì •í•  ì†ì„±ì˜ ì´ë¦„
value: ì„¤ì •í•  ì†ì„±ì˜ ìƒˆ ê°’
reveiver vmfhrtl wkcp
set()ë©”ì„œë“œëŠ” boolean ê°’ì„ ë°˜í™˜í•¨
*/
new Proxy(target, {
  set(target, property, value, receiver) {},
});
```

```js
/*
ì½”ë“œ ì¶œì²˜ : https://github.com/gilbutITbook/080326
*/
function createReactiveObject(target, callback) {
  const proxy = new Proxy(target, {
    set(obj, prop, value) {
      //objëŠ” a, propì€ í˜•ê·œ, valueëŠ” ì»¤í”Œ
      if (value !== obj[prop]) {
        const prev = obj[prop]; //prevëŠ” ì†”ë¡œ
        obj[prop] = value;
        callback(`${prop}ê°€ [${prev}] >> [${value}] ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤`);
      }
      return true;
    },
  });
  return proxy;
}
const a = {
  í˜•ê·œ: "ì†”ë¡œ",
};
const b = createReactiveObject(a, console.log);
//b.í˜•ê·œ = "ì†”ë¡œ";
b.í˜•ê·œ = "ì»¤í”Œ";
// í˜•ê·œê°€ [ì†”ë¡œ] >> [ì»¤í”Œ] ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤
```

</details>
<br />

### Vue.js 3.0

Vue.js 3.0ì—ì„œ `ref`ë‚˜ `reactive`ë¡œ ì •ì˜í•˜ë©´ í•´ë‹¹ ê°’ì´ ë³€ê²½ë˜ì—ˆì„ ë•Œ ìë™ìœ¼ë¡œ DOMì— ìˆëŠ” ê°’ì´ ë³€ê²½ëœë‹¤. ì´ëŠ” í”„ë¡ì‹œ ê°ì²´ë¥¼ ì´ìš©í•œ ì˜µì €ë²„ íŒ¨í„´ì„ ì´ìš©í•˜ì—¬ êµ¬í˜„í•œ ê²ƒ

<details>
<summary>Vue.js 3.0</summary>

Vue.jsì˜ ì˜µì €ë²„ íŒ¨í„´ì´ ë‹´ê¸´ ì½”ë“œ  
proxyMapì´ë¼ëŠ” í”„ë¡ì‹œ ê°ì¹˜ë¥¼ ì‚¬ìš©

```js
function createReactiveObject(
    target: Target,
    isReadonly: boolean,
    baseHandlers: ProxyHandler(any),
    collectionHandlers: ProxyHandler(any),
    proxyMap: WeakMap<Target, any)
    ){
    if (!isObject(target)) {
        if (DEV) {
            console.warn("value cannot be made reactive: ${String(target)!")
        }
        return target
    }
    // target is already a Proxy, return it.
    // exception: calling readonly() on a reactive object
    if (
    target [ReactiveFlags.RAW] &&
                !(isReadonly && target[ReactiveFlags.IS_REACTIVE])
    ){
    return target
    }
    // target already has corresponding Proxy
    const existingProxy = proxyMap. get (target)
    if (existingProxy) {
        return existingProxy
    }
    // only a whitelist of value types can be observed
    const targetType = getTargetType (target)
    if (targetType === TargetType.INVALID) {
        return target
    }
    const proxy = new Proxy (
    target,
    targetType=== TargetType.COLLECTION ? collectionHandlers:
            baseHandlers
    )
    proxyMap.set(target, proxy)
    return proxy
}
```

</details>

## ì°¸ê³ 

- ì±… : ë©´ì ‘ì„ ìœ„í•œ CS ì „ê³µì§€ì‹ ë…¸íŠ¸
- [js proxy](https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/Proxy/Proxy/set)
- [ì˜µì €ë²„ íŒ¨í„´ ê°œë… ë– ë¨¹ì—¬ë“œë¦½ë‹ˆë‹¤ ğŸ¥„](https://velog.io/@haero_kim/%EC%98%B5%EC%A0%80%EB%B2%84-%ED%8C%A8%ED%84%B4-%EA%B0%9C%EB%85%90-%EB%96%A0%EB%A8%B9%EC%97%AC%EB%93%9C%EB%A6%BD%EB%8B%88%EB%8B%A4)
- [ì˜µì €ë²„ íŒ¨í„´(Observer pattern)](https://gyoogle.dev/blog/design-pattern/Observer%20Pattern.html)
